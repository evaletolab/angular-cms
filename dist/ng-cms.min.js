!function(a){"use strict";var b={zenEdit:!0,ttlCache:864e5,root:"",githubRepo:"<user>/<repo>",githubApi:"https://api.github.com/repos/",githubToken:"2e36ce76cfb03358f0a38630007840e7cb432a24"};a.module("ngCMS",["ngRoute"]).constant("settings",angular.extend(b,ngCMSSettings||{}))}(angular),function(a){"use strict";function b(a,b,c,d,e,f,g,h,i){console.log("settings - ctrl",i),a.settings=i,a.isActiveDoc=function(a){return c.path()&&-1!==c.path().indexOf(a||"-09roif")},a.hrefBuild=function(a){return a=a.replace(":",""),i.root&&i.root.length?i.root+"/"+a:a},a.initCMS=function(){h.contentIndex().then(function(b){a.docArticles=b.docArticles})}}function c(a,b,c,d,e,f){a.article=c.article,f.contentIndex().then(function(){if(c.article){var e=f.find(c.article);if(!e)return b.path("404");d[0].title="Docs | "+e.title,a.docArticle=e}})}a.module("ngCMS").controller("CMSCtrl",b).controller("ContentCtrl",c),b.$inject=["$scope","$rootScope","$location","$routeParams","$document","$sce","$log","gitHubContent","settings"],c.$inject=["$scope","$location","$routeParams","$document","$log","gitHubContent","settings"]}(angular),function(a,b){"use strict";function c(a){a=a.replace(/^\s+|\s+$/g,""),a=a.toLowerCase();for(var b="ãàáäâẽèéëêìíïîõòóöôùúüûñç·/_,:;",c="aaaaaeeeeeiiiiooooouuuunc------",d=0,e=b.length;e>d;d++)a=a.replace(new RegExp(b.charAt(d),"g"),c.charAt(d));return a=a.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}function d(a,b,c,d,e){function f(a){var b=window.localStorage.getItem(a+"cachettl");if(b&&b<+new Date)return window.localStorage.removeItem(a),window.localStorage.removeItem(a+"cachettl"),b="expired",null;var c=window.localStorage.getItem(a);return JSON.parse(c)}function g(a){try{window.localStorage.setItem(a,JSON.stringify(strdata)),window.localStorage.setItem(a+"cachettl",+new Date+e.ttlCache)}catch(b){window.localStorage.removeItem(a),window.localStorage.removeItem(a+"cachettl")}}return{get:f,set:g}}function e(a,d,e,f,g){function h(a){var d={blogPosts:[],docArticles:[],pages:[]};return b.each(a,function(a){if("blob"===a.type){var b=a.path.split("/");if("blog"===b[0]){var e=b[4].strLeftBack("."),f=c(e);d.blogPosts.push({date:new Date(parseInt(b[1]),parseInt(b[2])-1,parseInt(b[3])),title:e,sha:a.sha,gitPath:a.path,titleSlug:f,urlPath:g.root+"/"+b.slice(0,4).concat(f).join("/")})}else if("docs"===b[0]){var h=b[1].split("_"),i=h[1].strLeftBack("."),j=c(i);d.docArticles.push({title:i,slug:j,sequence:h[0],gitPath:a.path,urlPath:g.root+"/docs/"+j})}else if("pages"===b[0]){var k=b[1].strLeftBack("."),j=c(k);d.pages.push({title:k,slug:j,gitPath:a.path,urlPath:g.root+"/pages/"+j})}}}),d.blogPosts=b.sortBy(d.blogPosts,"date").reverse(),d.docArticles=b.sortBy(d.docArticles,"sequence"),d}var i,j=g.githubApi+g.githubRepo,k="access_token="+g.githubToken,l=e.defer(),m={};return{initialize:function(a){angular.extend(g,a),j=g.githubApi+g.githubRepo,k="access_token="+g.githubToken;var b=j+"/git/trees/master?recursive=1&"+k;d({method:"GET",url:b,withCredentials:!1,cache:!0}).success(function(a){i=h(a.tree),f.info("github index",i),l.resolve(i)}).error(function(a){l.reject(a),f.error("Error initializing content index",a)})},contentIndex:function(){return l.promise},find:function(a){if(!i)return"";var c=b.find(i.docArticles,{slug:a});return c?c:b.find(i.pages,{slug:a})},loadSlug:function(a){if(m[a])return m[a].promise;var b=this;return this.contentIndex().then(function(){var c=b.find(a);return b.load(c)})},load:function(a){if(!a)return e.when("");var b=j+"/contents/"+a.gitPath+"?"+k,c={Accept:"application/vnd.github.VERSION.raw"};return m[a.slug]?m[a.slug].promise:(m[a.slug]=e.defer(),f.debug("fetching markdown content",b),d({method:"GET",url:b,headers:c,withCredentials:!1,cache:!0}).success(function(b){f.info("Content received ",b.length),m[a.slug].resolve(b)}).error(function(b){f.error("Error returned from API proxy",b),m[a.slug].reject(b)}),m[a.slug].promise)}}}a.module("ngCMS").factory("localCache",d).factory("gitHubContent",e),String.prototype.strLeftBack=function(a){var b=this.lastIndexOf(a),c=this.substring(0,b);return c},d.$inject=["$rootScope","$http","$q","$log","settings"],e.$inject=["$rootScope","$http","$q","$log","settings"]}(angular,_),function(a){"use strict";a.module("ngCMS").directive("cmsToc",[function(){return{restrict:"E",transclude:!0,templateUrl:"html/ng-cms.toc.html",link:function(){}}}]).directive("markdown",["$compile","$http","$parse","$sce","gitHubContent",function(a,b,c,d,e){function f(a,b){try{a.html(b)}catch(c){}a.find("table").addClass("table table-bordered"),angular.forEach(a.find("a"),function(a){a=angular.element(a),/^http[s]?\:\/\//.test(a.attr("href"))&&(a.addClass("external"),a.attr("target","external"))})}var g=new Showdown.converter({extensions:["table","github"]});return{restrict:"E",scope:{mdSrc:"@"},replace:!0,link:function(a,h,i){var j=c(i.markdownOpts||{});i.mdSrc?i.$observe("mdSrc",function(){b.get(i.mdSrc).then(function(a){h.html(g.makeHtml(a.data))},function(a){return j.silent?h.hide():void h.html(a)})}):i.markdownContent?i.$observe("markdownContent",function(a){f(h,g.makeHtml(a))}):i.markdownSlug?i.$observe("markdownSlug",function(a){a&&e.loadSlug(a).then(function(a){f(h,d.trustAsHtml(g.makeHtml(a)).toString())})}):h.html(g.makeHtml(h.text()))}}}]).directive("editMarkdown",["gitHubContent","settings",function(a,b){var c="http://github.com/",d="";return{restrict:"A",link:function(e,f,g){f.click(function(){b.zenEdit&&(d="#fullscreen_blob_contents"),a.contentIndex().then(function(){var e=a.find(g.editMarkdown);window.location.href=c+b.githubRepo+"/edit/master/"+e.gitPath+d})})}}}])}(angular),angular.module("ngCMS").run(["$templateCache",function(a){a.put("html/ng-cms.doc.html",'<div ng-controller="ContentCtrl"> <markdown markdown-slug="{{article}}"></markdown> <div class="clearfix"> <hr/> <button class="btn btn-primary pull-right btn-xs" edit-markdown="{{article}}">Improve this page</button> </div> </div>')}]);
//# sourceMappingURL=./dist/ng-cms.map